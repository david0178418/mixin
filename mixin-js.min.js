/*
  mixin-js.js 0.1.5
  (c) 2011, 2012 Kevin Malakoff - http://kmalakoff.github.com/mixin/
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
*/(function(){return function(e){return typeof define=="function"&&define.amd?define("mixin-js",e):e.call(this)}(function(){var e,t,n,r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=this.Mixin=typeof exports!="undefined"?exports:{},e.Core||(e.Core={}),e.VERSION="0.1.5",n=this._;if(!n&&typeof require!="undefined")try{n=require("lodash")}catch(s){try{n=require("underscore")}catch(s){({})}}return n&&n.hasOwnProperty("_")&&(n=n._),n||(n={}),e._=n,n.isArray||(n.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),n.isString||(n.isString=function(e){return!!(e===""||e&&e.charCodeAt&&e.substr)}),n.isFunction||(n.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)}),n.isEmpty||(n.isEmpty=function(e){var t,r;if(n.isArray(e)||n.isString(e))return e.length===0;for(t in e)return r=e[t],!1;return!0}),n.classOf||(n.classOf=function(e){return e instanceof Object?e.prototype&&e.prototype.constructor&&e.prototype.constructor.name?e.prototype.constructor.name:e.constructor&&e.constructor.name?e.constructor.name:void 0:void 0}),n.size||(n.size=function(e){var t,n;t=0;for(n in e)t++;return t}),n.find||(n.find=function(e,t){var n,r,i;for(r=0,i=e.length;r<i;r++){n=e[r];if(t(n))return n}return null}),n.remove||(n.remove=function(e,t){var n;n=e.indexOf(t);if(n<0)return;return e.splice(n,1),t}),n.keypathExists||(n.keypathExists=function(e,t){return!!n.keypathValueOwner(e,t)}),n.keypathValueOwner||(n.keypathValueOwner=function(e,t){var r,i,s,o,u;r=n.isString(t)?t.split("."):t;for(i=o=0,u=r.length;o<u;i=++o){s=r[i];if(i===r.length-1){if(e.hasOwnProperty(s))return e;return}if(!e.hasOwnProperty(s))return;e=e[s]}}),n.keypath||(n.keypath=function(e,t,r){var i;i=t.split("."),e=n.keypathValueOwner(e,i);if(!e)return;return arguments.length===3?(e[i[i.length-1]]=r,r):e[i[i.length-1]]}),e.Core._Validate=function(){function t(){}return t.mixinInfo=function(r,i,s){if(!r)throw new Error(""+s+": mixin_info missing");t.string(r.mixin_name,s,"mixin_name");if(!i&&e.Core._Manager.available_mixins.hasOwnProperty(r.mixin_name))throw new Error(""+s+": mixin_info '"+r.mixin_name+"' already registered");if(!r.mixin_object)throw new Error(""+s+": mixin_info '"+r.mixin_name+"' missing mixin_object");if(!(r.mixin_object instanceof Object))throw new Error(""+s+": mixin_info '"+r.mixin_name+"' mixin_object is invalid");if(r.initialize&&!n.isFunction(r.initialize))throw new Error(""+s+": mixin_info '"+r.mixin_name+"' initialize function is invalid");if(r.destroy&&!n.isFunction(r.destroy))throw new Error(""+s+": mixin_info '"+r.mixin_name+"' destroy function is invalid")},t.instanceAndMixinName=function(e,n,r){if(!e)throw new Error(""+r+": mix_target missing");return t.string(n,r,"mixin_name"),t.instanceOrArray(e,r,"mix_target",n)},t.classConstructorAndMixinName=function(e,r,i){if(!e)throw new Error(""+i+": class constructor missing");t.string(r,i,"mixin_name");if(!n.isFunction(e))throw new Error(""+i+": class constructor invalid for '"+r+"'")},t.exists=function(e,t,n){if(e===void 0)throw new Error(""+t+": "+n+" missing")},t.object=function(e,t,r){if(e===void 0)throw new Error(""+t+": "+r+" missing");if(typeof e!="object"||n.isArray(e))throw new Error(""+t+": "+r+" invalid")},t.uint=function(e,t,n){if(e===void 0)throw new Error(""+t+": "+n+" missing");if(typeof e=="number"||e<0||Math.floor(e)!==e)throw new Error(""+t+": "+n+" invalid")},t.string=function(e,t,r){if(e===void 0)throw new Error(""+t+": "+r+" missing");if(!n.isString(e))throw new Error(""+t+": "+r+" invalid")},t.stringArrayOrNestedStringArray=function(e,t,r){var i,s,o;if(e===void 0)throw new Error(""+t+": "+r+" missing");if(!n.isArray(e))throw new Error(""+t+": "+r+" invalid");for(s=0,o=string_or_array.length;s<o;s++){i=string_or_array[s];if(n.isArray(i)&&(!i.length||!n.isString(i[0]))||!n.isString(i))throw new Error(""+t+": "+r+" invalid")}},t.callback=function(e,t,r){if(e===void 0)throw new Error(""+t+": "+r+" missing");if(!n.isFunction(e))throw new Error(""+t+": "+r+" invalid")},t.instance=function(e,t,r){if(e===void 0)throw new Error(""+t+": "+r+" missing");if(typeof e!="object"||n.isArray(e)||!n.isFunction(e.constructor)||e.constructor.name==="Object")throw new Error(""+t+": "+r+" invalid")},t.instanceOrArray=function(e,t,r,i){if(e===void 0)throw new Error(""+t+": "+r+" missing");if(typeof e!="object"||!n.isFunction(e.constructor)||e.constructor.name==="Object"||n.isArray(e))throw new Error(""+t+": "+r+" invalid")},t.instanceWithMixin=function(r,i,s,o){t.instance(r,s,o);if(!e.hasMixin(r,i))throw new Error(""+s+": "+o+" missing mixin '"+i+"' on "+n.classOf(r))},t.noKey=function(e,t,n,r){if(e.hasOwnProperty(t))throw new Error(""+n+": "+t+" already exists for "+r)},t.hasKey=function(e,t,n,r){if(!e.hasOwnProperty(t))throw new Error(""+n+": "+t+" does not exist for "+r)},t}(),e.Core._InstanceRecord=function(){function t(e){this.mix_target=e,this.initialized_mixins={}}return t.prototype.destroy=function(){if(!n.isEmpty(this.initialized_mixins))throw new Error("Mixin: non-empty instance record being destroyed");return this.mix_target=null},t.prototype.hasMixin=function(e,t){var n;return n=this.initialized_mixins.hasOwnProperty(e),n||!t?n:(this.initialized_mixins[e]={is_destroyed:!1},!0)},t.prototype.collectMixins=function(e){var t,n,r;r=this.initialized_mixins;for(t in r)n=r[t],e.push(t)},t.prototype.initializeMixin=function(e,t){this.initialized_mixins[e.mixin_name]={is_destroyed:!1,destroy:e.destroy};if(e.initialize)return e.initialize.apply(this.mix_target,t)},t.prototype.destroyMixin=function(e){var t,n,r,i;if(e)return this.initialized_mixins.hasOwnProperty(e)?this._destroyMixinInfo(e):!1;n=!1,i=this.initialized_mixins;for(t in i)r=i[t],n=!0,this._destroyMixinInfo(t);return n},t.prototype._destroyMixinInfo=function(t){var n;return n=this.initialized_mixins[t],n.is_destroyed?!0:(n.is_destroyed=!0,n.destroy&&(n.destroy.apply(this.mix_target),n.destroy=null),e.Core._Manager._destroyInstanceData(this.mix_target,t),delete this.initialized_mixins[t],!0)},t}(),e.Core._ClassRecord=function(){function t(e){this.constructor=e,this.mixins={},this.instance_records=[]}return t.prototype.mixIntoClass=function(e,t){var r,s,o;if(this.mixins.hasOwnProperty(t.mixin_name))return;this.mixins[t.mixin_name]=t;if(!t.force){o=t.mixin_object;for(r in o){s=o[r];if(r in e)throw new Error("Mixin: property '"+r+"' clashes with existing property on '"+n.classOf(e))}}return i(e.constructor.prototype,t.mixin_object)},t.prototype.classHasMixin=function(e){return this.mixins.hasOwnProperty(e)},t.prototype.instanceHasMixin=function(t,n,r){var i;return i=this._getInstanceRecord(t),r?(this.mixins.hasOwnProperty(n)||(this.mixins[n]=e.Core._Manager._getMixinInfo(n)),i||(i=new e.Core._InstanceRecord(t),this.instance_records.push(i)),i.hasMixin(n,r)):i?i.hasMixin(n):!1},t.prototype.collectMixinsForInstance=function(e,t){var n;n=this._getInstanceRecord(t);if(!n)return;return n.collectMixins(e)},t.prototype.initializeInstance=function(t,n,r){var i;i=this._getInstanceRecord(t);if(i){i.initializeMixin(n,r);return}return i=new e.Core._InstanceRecord(t),this.instance_records.push(i),i.initializeMixin(n,r)},t.prototype.destroyInstance=function(e,t){var r,i,s;if(t&&!this.mixins.hasOwnProperty(t))return!1;s=!1,r=this.instance_records.length-1;while(r>=0){i=this.instance_records[r];if(i.mix_target===e&&i.destroyMixin(t)){s=!0,n.isEmpty(i.initialized_mixins)&&(i.destroy(),this.instance_records.splice(r,1));if(t)return!0}r--}return s},t.prototype._getInstanceRecord=function(e){var t,n,r,i;i=this.instance_records;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.mix_target===e)return t}return void 0},t}(),e.Core._Manager=function(){function t(){}return t.available_mixins={},t.registerMixin=function(n,r){return e.DEBUG&&e.Core._Validate.mixinInfo(n,r,"Mixin.registerMixin"),t.available_mixins[n.mixin_name]=n,!0},t.isAvailable=function(e){return t.available_mixins.hasOwnProperty(e)},t._getMixinInfo=function(e){return t.available_mixins[e]},t.mixin=function(r){var i,s,o,u,a,f,l=this;u=function(n,r,i){var s,o;if(e.DEBUG){e.Core._Validate.instanceAndMixinName(n,r,"Mixin.mixin","mix_target");if(!l.isAvailable(r))throw new Error("Mixin.mixin: '"+r+"' not found")}o=t.available_mixins[r];if(!o)throw new Error("Mixin.mixin: '"+r+"' not found");if(l.hasMixin(n,o.mixin_name))return;return s=t._findOrCreateClassRecord(n,o),s.mixIntoClass(n,o),s.initializeInstance(n,o,Array.prototype.slice.call(arguments,2))},i=Array.prototype.slice.call(arguments,1);if(!i.length)throw new Error("Mixin: mixin_name missing");if(i.length>1){s=i[1];if(!(n.isString(s)&&t.isAvailable(s)||n.isArray(s)&&s.length>=1&&n.isString(s[0])&&t.isAvailable(s[0])))return u.apply(this,arguments),r}for(a=0,f=i.length;a<f;a++)o=i[a],n.isArray(o)?u.apply(this,[r].concat(o)):u(r,o);return r},t.mixout=function(t,n){var r,i,s,o,u,a,f,l,c,h=this;e.DEBUG&&e.Core._Validate.instance(t,"Mixin.mixout","mix_target"),s=function(t,n){var r,i,s,o;e.DEBUG&&e.Core._Validate.string(n,"Mixin.mixout","mixin_name");if(t.constructor._mixin_class_records){o=t.constructor._mixin_class_records;for(i=0,s=o.length;i<s;i++){r=o[i];if(r.destroyInstance(t,n))return t}}return t};if(arguments.length>1){l=Array.prototype.slice.call(arguments,1);for(o=0,a=l.length;o<a;o++)i=l[o],s(t,i)}else if(t.constructor._mixin_class_records){c=t.constructor._mixin_class_records;for(u=0,f=c.length;u<f;u++){r=c[u];if(r.destroyInstance(t))return t}}return t},t.hasMixin=function(n,r,i){var s,o;return i?t.hasMixin(n,r)?!0:(o=t.available_mixins[r],o?(s=t._findOrCreateClassRecord(n,o),s.instanceHasMixin(n,r,i)):!1):(e.DEBUG&&e.Core._Validate.instanceAndMixinName(n,r,"Mixin.hasMixin","mix_target"),t.hasInstanceData(n,r)?!0:(s=t._findClassRecord(n,r),s?s.instanceHasMixin(n,r):!1))},t.mixins=function(t){var n,r,i,s,o;e.DEBUG&&e.Core._Validate.instance(t,r,"Mixin.mixins","mix_target"),r=[];if(t.constructor._mixin_class_records){o=t.constructor._mixin_class_records;for(i=0,s=o.length;i<s;i++)n=o[i],n.collectMixinsForInstance(r,t)}return r},t._getClassRecords=function(e){var t,n,r,i,s,o;n=[],r=e.constructor;while(r){if(r._mixin_class_records){o=r._mixin_class_records;for(i=0,s=o.length;i<s;i++)t=o[i],e instanceof t.constructor&&n.push(t)}r=r.__super__&&r.__super__.constructor!==r?r.__super__.constructor:void 0}return n},t._findClassRecord=function(e,t){var n,r,i,s;r=this._getClassRecords(e);for(i=0,s=r.length;i<s;i++){n=r[i];if(n.classHasMixin(t))return n}return void 0},t._findOrCreateClassRecord=function(r,i){var s,o,u,a,f;s=t._findClassRecord(r,i.mixin_name);if(s)return s;r.constructor._mixin_class_records&&(s=n.find(r.constructor._mixin_class_records,function(e){return e.constructor===r.constructor}));if(!s){s=new e.Core._ClassRecord(r.constructor);if(r.constructor._mixin_class_records){f=!1,o=0,u=r.constructor._mixin_class_records.length;while(o<u){a=r.constructor._mixin_class_records[o];if(r instanceof a.constructor){r.constructor._mixin_class_records.splice(o,0,s),f=!0;break}o++}f||r.constructor._mixin_class_records.push(s)}else r.constructor._mixin_class_records=[s];e._statistics&&e._statistics.addClassRecord(s)}return s},t.hasInstanceData=function(t,n){return e.DEBUG&&e.Core._Validate.instanceAndMixinName(t,n,"Mixin.hasInstanceData","mix_target"),!!t._mixin_data&&!!t._mixin_data.hasOwnProperty(n)},t.instanceData=function(r,i,s){if(e.DEBUG){e.Core._Validate.instanceAndMixinName(r,i,"Mixin.instanceData","mix_target");if(s===void 0){if(!("_mixin_data"in r))throw new Error("Mixin.instanceData: no instance data on '"+n.classOf(r)+"'");if(!r._mixin_data.hasOwnProperty(i))throw new Error("Mixin.instanceData: mixin '"+i+"' instance data not found on '"+n.classOf(r)+"'")}else if(!t.hasMixin(r,i))throw new Error("Mixin.instanceData: mixin '"+i+"' not mixed into '"+n.classOf(r)+"'")}return s!==void 0&&(r._mixin_data||(r._mixin_data={}),r._mixin_data[i]=s),r._mixin_data[i]},t._destroyInstanceData=function(e,t){var r;if(!e._mixin_data)return void 0;r=e._mixin_data[t],delete e._mixin_data[t];if(n.isEmpty(e._mixin_data))return delete e._mixin_data},t}(),e.registerMixin=e.Core._Manager.registerMixin,e.isAvailable=e.Core._Manager.isAvailable,e.mixin=e["in"]=e.Core._Manager.mixin,e.mixout=e.out=e.Core._Manager.mixout,e.hasMixin=e.exists=e.Core._Manager.hasMixin,e.mixins=e.Core._Manager.mixins,e.hasInstanceData=e.hasID=e.Core._Manager.hasInstanceData,e.instanceData=e.iD=e.Core._Manager.instanceData,typeof exports!="undefined"&&(exports.Mixin=e),!e&&typeof exports!="undefined"&&(this.Mixin=require("mixin-js").Mixin),this.Mixin.STATISTICS===void 0&&(this.Mixin.STATISTICS=!0),e.Core.Statistics=function(){function e(){this.class_records=[]}return e.prototype.addClassRecord=function(e){return this.class_records.push(e)},e.prototype.purge=function(){return this.class_records=[],this.clear()},e.prototype.clear=function(){return this.by_instance_with_data=null,this.by_instance_get_mixins=null,this.by_mixin_get_instances=null,this.by_mixin_get_constructors=null,this.by_constructor_get_instances=null},e.prototype.update=function(){return this.clear(),this.byInstance_getMixins(),this.byInstance_withData(),this.byMixin_getInstances(),this.byMixin_getConstructors(),this.byConstructor_getInstances()},e.prototype.byInstance_getMixins=function(){var e,t,n,r;if(!this.by_instance_get_mixins){this.by_instance_get_mixins=[],r=this.class_records;for(t=0,n=r.length;t<n;t++)e=r[t],this.classRecordGetMixinsByInstance(e,this.by_instance_get_mixins)}return this.by_instance_get_mixins},e.prototype.byInstance_withData=function(){var e,t,n,r;if(!this.by_instance_with_data){this.by_instance_with_data=[],r=this.class_records;for(t=0,n=r.length;t<n;t++)e=r[t],this.classRecordGetInstancesWithData(e,this.by_instance_with_data)}return this.by_instance_with_data},e.prototype.byMixin_getInstances=function(){var e,t,n,r;if(!this.by_mixin_get_instances){this.by_mixin_get_instances={},r=this.class_records;for(t=0,n=r.length;t<n;t++)e=r[t],this.classRecordGetInstancesByMixin(e,this.by_mixin_get_instances)}return this.by_mixin_get_instances},e.prototype.byMixin_getConstructors=function(){var e,t,n,r;if(!this.by_mixin_get_constructors){this.by_mixin_get_constructors={},r=this.class_records;for(t=0,n=r.length;t<n;t++)e=r[t],this.classRecordGetMixins(e,this.by_mixin_get_constructors)}return this.by_mixin_get_constructors},e.prototype.byConstructor_getInstances=function(){var e,t,n,r;if(!this.by_constructor_get_instances){this.by_constructor_get_instances={},r=this.class_records;for(t=0,n=r.length;t<n;t++)e=r[t],this.classRecordGroupInstances(e,this.by_constructor_get_instances)}return this.by_constructor_get_instances},e.prototype.classRecordGetInstancesWithData=function(e,t){var n,r,i,s;s=e.instance_records;for(r=0,i=s.length;r<i;r++)n=s[r],n.mix_target&&n.mix_target._mixin_data&&t.push(n.mix_target)},e.prototype.classRecordGetInstancesByMixin=function(e,t){var n,r,i,s,o,u,a;if(!e.instance_records.length)return;u=e.instance_records;for(s=0,o=u.length;s<o;s++){n=u[s],a=n.initialized_mixins;for(r in a)i=a[r],t.hasOwnProperty(r)||(t[r]=[]),t[r].push(n.mix_target)}},e.prototype.classRecordGetMixinsByInstance=function(e,t){var n,r,i,s,o,u,a,f;a=e.instance_records;for(o=0,u=a.length;o<u;o++){n=a[o],s=[],f=n.initialized_mixins;for(r in f)i=f[r],s.push(r);t.push({instance:n.mix_target,mixins:s})}},e.prototype.classRecordGroupInstances=function(e,t){var n,r,i,s;if(!e.instance_records.length)return;t.hasOwnProperty(e.constructor.name)||(t[e.constructor]=[]),s=e.instance_records;for(r=0,i=s.length;r<i;r++)n=s[r],t[e.constructor].push(n.mix_target)},e.prototype.classRecordGetMixins=function(e,t,n){var r,i,s;s=e.mixins;for(r in s)i=s[r],t.hasOwnProperty(r)||(t[r]=[]),t[r].push(e.constructor)},e}(),this.Mixin.STATISTICS&&(e._statistics=new e.Core.Statistics),e=!window.Mixin&&typeof require!="undefined"?require("mixin-js"):window.Mixin,n=e._,t=this,e.AutoMemory||(e.AutoMemory={}),e.AutoMemory.Property=function(){function t(e){this.owner=e}return t.prototype.setArgs=function(){var t,r,i,s;if(!arguments.length)throw new Error("Mixin.AutoMemory: missing key");this.args=Array.prototype.slice.call(arguments);if(!e.DEBUG)return this;if(n.isArray(this.args[0])){s=this.args;for(r=0,i=s.length;r<i;r++)t=s[r],this._validateEntry(t)}else this._validateEntry(this.args)},t.prototype.destroy=function(){var e,t,r,i;if(n.isArray(this.args[0])){i=this.args;for(t=0,r=i.length;t<r;t++)e=i[t],this._destroyEntry(e)}else this._destroyEntry(this.args)},t.prototype._validateEntry=function(e){var t,r;r=e[0],t=e.length>1?e[1]:void 0;if(!n.keypathExists(this.owner,r))throw new Error("Mixin.AutoMemory: property '"+r+"' doesn't exist on '"+n.classOf(this.owner)+"'");if(t&&!n.isFunction(t)&&!n.isString(t))throw new Error("Mixin.AutoMemory: unexpected function reference for property '"+r+"' on '"+n.classOf(this.owner)+"'")},t.prototype._destroyEntry=function(e){var t,r,i,s,o,u,a,f;r=e[0],t=e.length>1?e[1]:void 0;if(!t){i=n.keypathValueOwner(this.owner,r);if(!i)throw new Error("Mixin.AutoMemory: property '"+r+"' doesn't exist on '"+n.classOf(this.owner)+"'");i[r]=null;return}o=n.keypath(this.owner,r);if(!o)return;if(n.isFunction(t))t.apply(this.owner,[o].concat(e.length>2?e.slice(2):[]));else if(n.isFunction(o[t]))o[t].apply(o,e.length>2?e.slice(2):[]);else{f=e.slice(1);for(u=0,a=f.length;u<a;u++)s=f[u],this._destroyEntry([s])}return n.keypath(this.owner,r,null)},t}(),e.AutoMemory.WrappedProperty=function(){function r(t,r,i,s){var o,u,a;this.owner=t,this.key=r,this.fn_ref=i,this.wrapper=s;if(this.fn_ref&&n.isArray(this.fn_ref)){if(e.DEBUG&&!this.fn_ref.length)throw new Error("Mixin.AutoMemory: unexpected function reference");this.args=this.fn_ref.splice(1),this.fn_ref=this.fn_ref[0]}if(!e.DEBUG)return this;if(!this.key)throw new Error("Mixin.AutoMemory: missing key");if(n.isArray(this.key)){a=this.key;for(o=0,u=a.length;o<u;o++){r=a[o];if(!n.keypathExists(this.owner,r))throw new Error("Mixin.AutoMemory: property '"+r+"' doesn't exist on '"+n.classOf(this.owner)+"'")}}else if(!n.keypathExists(this.owner,this.key))throw new Error("Mixin.AutoMemory: property '"+this.key+"' doesn't exist on '"+n.classOf(this.owner)+"'");if(this.fn_ref&&!n.isFunction(this.fn_ref)&&!n.isString(this.fn_ref))throw new Error("Mixin.AutoMemory: unexpected function reference");if(!this.wrapper)throw new Error("Mixin.AutoMemory: missing wrapper")}return r.prototype.destroy=function(){var e,t,r,i;if(n.isArray(this.key)){i=this.key;for(t=0,r=i.length;t<r;t++)e=i[t],this._destroyKey(e)}else this._destroyKey(this.key)},r.prototype._destroyKey=function(r){var i,s;if(!this.fn_ref){n.keypath(this.owner,r,null);return}i=n.keypath(this.owner,r);if(!i)return;s=t.$(i);if(n.isFunction(this.fn_ref))this.fn_ref.apply(this.owner,[s].concat(this.args?this.args.slice():[]));else{if(e.DEBUG&&!n.isFunction(s[this.fn_ref]))throw new Error("Mixin.AutoMemory: function '"+this.fn_ref+"' missing for wrapped property '"+r+"' on '"+n.classOf(this.owner)+"'");s[this.fn_ref].apply(s,this.args)}return n.keypath(this.owner,r,null)},r}(),e.AutoMemory.Function=function(){function t(t,r,i){this.object=t,this.fn_ref=r,this.args=i;if(!e.DEBUG)return this;if(!this.fn_ref)throw new Error("Mixin.AutoMemory: missing fn_ref");if(!n.isFunction(this.fn_ref)&&!(this.object&&n.isString(this.fn_ref)&&n.isFunction(this.object[this.fn_ref])))throw new Error("Mixin.AutoMemory: unexpected function reference")}return t.prototype.destroy=function(){if(!this.object){this.fn_ref.apply(null,this.args);return}if(!n.isFunction(this.fn_ref)){this.object[this.fn_ref].apply(this.object,this.args);return}return this.fn_ref.apply(this.object,[this.object].concat(this.args?this.args.slice():[]))},t}(),e.AutoMemory._mixin_info={mixin_name:"AutoMemory",initialize:function(){return e.instanceData(this,"AutoMemory",[])},destroy:function(){var t,n,r,i;n=e.instanceData(this,"AutoMemory"),e.instanceData(this,"AutoMemory",[]);for(r=0,i=n.length;r<i;r++)t=n[r],t.destroy()},mixin_object:{autoProperty:function(t,n){var r;return r=new e.AutoMemory.Property(this),r.setArgs.apply(r,arguments),e.instanceData(this,"AutoMemory").push(r),this},autoWrappedProperty:function(n,r,i){return i||(i=t.$),e.instanceData(this,"AutoMemory").push(new e.AutoMemory.WrappedProperty(this,n,r,i)),this},autoFunction:function(t,n){return e.instanceData(this,"AutoMemory").push(new e.AutoMemory.Function(t,n,Array.prototype.slice.call(arguments,2))),this}}},e.registerMixin(e.AutoMemory._mixin_info),e.Flags||(e.Flags={}),e.Flags._mixin_info={mixin_name:"Flags",initialize:function(t,n){return t==null&&(t=0),e.instanceData(this,"Flags",{flags:t,change_callback:n})},mixin_object:{flags:function(t){var n,r;return n=e.instanceData(this,"Flags"),t!==void 0&&(r=n.flags,n.flags=t,n.change_callback&&r!==n.flags&&n.change_callback(n.flags)),n.flags},hasFlags:function(t){var n;return n=e.instanceData(this,"Flags"),!!(n.flags&t)},setFlags:function(t){var n,r;return n=e.instanceData(this,"Flags"),r=n.flags,n.flags|=t,n.change_callback&&r!==n.flags&&n.change_callback(n.flags),n.flags},resetFlags:function(t){var n,r;return n=e.instanceData(this,"Flags"),r=n.flags,n.flags&=~t,n.change_callback&&r!==n.flags&&n.change_callback(n.flags),n.flags}}},e.registerMixin(e.Flags._mixin_info),e.RefCount||(e.RefCount={}),e.RefCount._mixin_info={mixin_name:"RefCount",initialize:function(t){return e.instanceData(this,"RefCount",{ref_count:1,release_callback:t})},mixin_object:{retain:function(){var t;t=e.instanceData(this,"RefCount");if(t.ref_count<=0)throw new Error("Mixin.RefCount: ref_count is corrupt: "+t.ref_count);return t.ref_count++,this},release:function(){var t;t=e.instanceData(this,"RefCount");if(t.ref_count<=0)throw new Error("Mixin.RefCount: ref_count is corrupt: "+t.ref_count);return t.ref_count--,t.ref_count===0&&t.release_callback&&t.release_callback(this),this},refCount:function(){return e.instanceData(this,"RefCount").ref_count}}},e.registerMixin(e.RefCount._mixin_info),e.Subscriptions||(e.Subscriptions={}),e.Subscriptions._SubscriptionLink=function(){function t(t,r,i,s){var o;this.subscription=t,this.subscriber=r,this.notification_callback=i,this.options=n.clone(s||{}),o=e.instanceData(this.subscriber,"Subscriber"),o.subscription_backlinks.push(this)}return t.prototype.mustKeepUntilDestroyed=function(){return this.options.keep_until_destroyed===void 0||!this.options.keep_until_destroyed},t.prototype.destroy=function(){var t;if(!this.subscription)throw new Error("Mixin.Subscriptions: _SubscriptionLink destroyed multiple times");return this.options.destroy&&(this.options.destroy(),this.options.destroy=null),t=e.instanceData(this.subscriber,"Subscriber"),n.remove(t.subscription_backlinks,this),n.remove(this.subscription.subscription_links,this),this.subscription=null,this.subscriber=null,this.notification_callback=null,this.options=null},t}(),e.Subscription||(e.Subscription={}),e.Subscription.TYPE={},e.Subscription.TYPE.MULTIPLE=0,e.Subscription.TYPE.EXCLUSIVE=1,e.Subscriptions._Subscription=function(){function t(t,n){this.observable=t,this.subscription_type=n;if(e.DEBUG)if(typeof this.subscription_type!="number"||this.subscription_type<e.Subscription.TYPE.MULTIPLE||this.subscription_type>e.Subscription.TYPE.EXCLUSIVE)throw new Error("Mixin.Subscriptions: Mixin.Subscription.TYPE is invalid");this.subscription_links=[]}return t.prototype.addSubscriber=function(t,n,r){return this.subscription_type===e.Subscription.TYPE.EXCLUSIVE&&this.removeSubscribers(function(e){return e.mustKeepUntilDestroyed()}),this.subscription_links.push(new e.Subscriptions._SubscriptionLink(this,t,n,r))},t.prototype.removeSubscriber=function(e,t,r){var i;i=n.find(this.subscription_links,function(n){return e===n.subscriber&&t===n.notification_callback});if(!i)throw new Error("Mixin.Subscriptions.removeSubscriber: subscription '"+r+"' does not exist for '"+n.classOf(e)+"'");return n.remove(this.subscription_links,i),i.destroy()},t.prototype.subscribers=function(e){var t,n,r,i;i=this.subscription_links;for(n=0,r=i.length;n<r;n++)t=i[n],e.push(t.subscriber)},t.prototype.notifySubscribers=function(){var e,t,n,r,i;e=Array.prototype.slice.call(arguments),i=this.subscription_links;for(n=0,r=i.length;n<r;n++)t=i[n],t.notification_callback.apply(t.subscriber,e)},t.prototype.removeSubscribers=function(e){var t,r,i,s,o,u;if(e){t=n.select(this.subscription_links,e);if(t.length===0)return;this.subscription_links=n.difference(this.subscription_links,t);for(i=0,o=t.length;i<o;i++)r=t[i],r.destroy()}else{t=this.subscription_links,this.subscription_links=[];for(s=0,u=t.length;s<u;s++)r=t[s],r.destroy()}},t.prototype.destroy=function(){var e,t,n,r;t=this.subscription_links,this.subscription_links=[];for(n=0,r=t.length;n<r;n++)e=t[n],e.destroy()},t}(),e.Subscriptions.Observable||(e.Subscriptions.Observable={}),e.Subscriptions.Observable._mixin_info={mixin_name:"Observable",initialize:function(){var t,r,i;e.instanceData(this,"Observable",{subscriptions:{},is_destroyed:!1});for(r=0,i=arguments.length;r<i;r++)t=arguments[r],this.publishSubscription.apply(this,n.isArray(t)?t:[t])},destroy:function(){var t,n,r,i,s;t=e.instanceData(this,"Observable");if(t.is_destroyed)throw new Error("Mixin.Observable.destroy: already destroyed");t.is_destroyed=!0,r=t.subscriptions,t.subscriptions=[];for(i=0,s=r.length;i<s;i++)n=r[i],n.destroy()},mixin_object:{hasSubscription:function(t){var n;return e.DEBUG&&e.Core._Validate.string(t,"Mixin.Observable.hasSubscription","subscription_name"),n=e.instanceData(this,"Observable"),n.subscriptions.hasOwnProperty(t)},publishSubscription:function(t,n){var r;return r=e.instanceData(this,"Observable"),n===void 0&&(n=e.Subscription.TYPE.MULTIPLE),e.DEBUG&&(e.Core._Validate.string(t,"Mixin.Observable.publishSubscription","subscription_name"),e.Core._Validate.noKey(r.subscriptions,t,"Mixin.Observable.publishSubscription","subscription_name")),r.subscriptions[t]=new e.Subscriptions._Subscription(this,n),this},subscriptions:function(){var t,n,r,i,s;t=e.instanceData(this,"Observable"),r=[],s=t.subscriptions;for(n in s)i=s[n],r.push(n);return r},subscribers:function(t){var r,i,s,o,u,a;s=[],r=e.instanceData(this,"Observable");if(t===void 0){u=r.subscriptions;for(i in u)o=u[i],o.subscribers(s)}else{if(!r.subscriptions.hasOwnProperty(t))throw new Error("Mixin.Observable.subscribers: subscriber '"+_classOf(this)+"' does not recognize '"+t+"'");a=r.subscriptions;for(i in a)o=a[i],o.subscription_name===t&&o.subscribers(s)}return n.uniq(s)},addSubscriber:function(t,r){var i,s,o,u,a,f,l;o=e.instanceData(this,"Observable"),a=function(n,r,i){var s;return i||(i={}),e.DEBUG&&(e.Core._Validate.string(n,"Mixin.Observable.addSubscriber","subscription_name"),e.Core._Validate.callback(r,"Mixin.Observable.addSubscriber","notification_callback"),e.Core._Validate.object(i,"Mixin.Observable.addSubscriber","options"),i.destroy!==void 0&&e.Core._Validate.callback(i.destroy,"Mixin.Observable.addSubscriber","options.destroy")),e.Core._Validate.hasKey(o.subscriptions,n,"Mixin.Observable.addSubscriber","subscription_name"),s=o.subscriptions[n],s.addSubscriber(t,r,i)},i=Array.prototype.slice.call(arguments,1),e.Core._Validate.instanceWithMixin(t,"Subscriber","Mixin.Observable.addSubscriber","subscriber");if(i.length>1){s=i[1];if(!(n.isString(s)&&this.hasSubscription(s)||n.isArray(s)&&s.length>=1&&n.isString(s[0])&&this.hasSubscription(s[0])))return a.apply(this,Array.prototype.slice.call(arguments,1)),this}for(f=0,l=i.length;f<l;f++)u=i[f],n.isArray(u)?a.apply(this,u):a.apply(u);return this},notifySubscribers:function(t){var n,r;n=e.instanceData(this,"Observable");if(n.is_destroyed)return;e.DEBUG&&(e.Core._Validate.string(t,"Mixin.Observable.notifySubscribers","subscription_name"),e.Core._Validate.hasKey(n.subscriptions,t,"Mixin.Observable.notifySubscribers")),r=n.subscriptions[t];if(!r)return;return r.notifySubscribers.apply(r,Array.prototype.slice.call(arguments,1)),this},removeSubscriber:function(t,r,i){var s,o,u,a,f,l,c;u=e.instanceData(this,"Observable"),f=function(n,r){var i;return e.DEBUG&&(e.Core._Validate.string(n,"Mixin.Observable.removeSubscriber","subscription_name"),e.Core._Validate.callback(r,"Mixin.Observable.removeSubscriber","notification_callback")),e.Core._Validate.hasKey(u.subscriptions,n,"Mixin.Observable.removeSubscriber","subscription_name"),i=u.subscriptions[n],i.removeSubscriber(t,r,n)},s=Array.prototype.slice.call(arguments,1),e.DEBUG&&e.Core._Validate.instanceWithMixin(t,"Subscriber","Mixin.Observable.removeSubscriber","subscriber");if(s.length>1){o=s[1];if(!(n.isString(o)&&this.hasSubscription(o)||n.isArray(o)&&o.length>=1&&n.isString(o[0])&&this.hasSubscription(o[0])))return f.apply(this,Array.prototype.slice.call(arguments,1)),this}for(l=0,c=s.length;l<c;l++)a=s[l],n.isArray(a)?f.apply(this,a):f.apply(a);return this},removeSubscribers:function(t,n){var r,i,s,o;r=e.instanceData(this,"Observable"),e.DEBUG&&(t!==void 0&&(e.Core._Validate.string(t,"Mixin.Observable.removeSubscribers","subscription_name"),e.Core._Validate.hasKey(r.subscriptions,t,"Mixin.Observable.removeSubscribers")),n!==void 0&&e.Core._Validate.callback(n,"Mixin.Observable.removeSubscribers","test_fn"));if(t){s=r.subscriptions[t];if(!s)return;s.removeSubscribers(n)}else{o=r.subscriptions;for(i in o)s=o[i],s.removeSubscribers(n)}return this}}},e.Subscriptions.Subscriber||(e.Subscriptions.Subscriber={}),e.Subscriptions.Subscriber._mixin_info={mixin_name:"Subscriber",initialize:function(){return e.instanceData(this,"Subscriber",{subscription_backlinks:[],is_destroyed:!1})},destroy:function(){var t,n,r,i,s;r=e.instanceData(this,"Subscriber");if(r.is_destroyed)throw new Error("Mixin.Subscriber.destroy: already destroyed");r.is_destroyed=!0,n=r.subscription_backlinks,r.subscription_backlinks=[];for(i=0,s=n.length;i<s;i++)t=n[i],t.destroy()},mixin_object:{observables:function(t){var r,i,s,o,u,a,f,l,c;r=e.instanceData(this,"Subscriber"),i=[];if(t===void 0){l=r.subscription_backlinks;for(o=0,a=l.length;o<a;o++)s=l[o],s.subscription&&s.subscription.subscription_name===t&&i.push(s.subscription.observable)}else{e.DEBUG&&e.Core._Validate.string(t,"Mixin.Subscriptions.observables","subscription_name"),c=r.subscription_backlinks;for(u=0,f=c.length;u<f;u++)s=c[u],s.subscription&&i.push(s.subscription.observable)}return n.uniq(i)}}},e.Subscriptions.ObservableSubscriber||(e.Subscriptions.ObservableSubscriber={}),e.Subscriptions.ObservableSubscriber._mixin_info={mixin_name:"ObservableSubscriber",mixin_object:{},initialize:function(){return e["in"](this,"Subscriber",["Observable"].concat(Array.prototype.slice.call(arguments)))},destroy:function(){return e.out(this,"Subscriber","Observable")}},e.registerMixin(e.Subscriptions.Observable._mixin_info),e.registerMixin(e.Subscriptions.Subscriber._mixin_info),e.registerMixin(e.Subscriptions.ObservableSubscriber._mixin_info),e.Timeouts||(e.Timeouts={}),e.Timeouts._mixin_info={mixin_name:"Timeouts",initialize:function(){return e.instanceData(this,"Timeouts",{timeouts:{}})},destroy:function(){return this.killAllTimeouts()},mixin_object:{addTimeout:function(t,r,i){var s,o,u,a=this;e.Core._Validate.string(t,"Mixin.Timeouts.addTimeout","timeout_name"),e.Core._Validate.callback(r,"Mixin.Timeouts.addTimeout","callback");if(i===void 0)throw new Error("Mixin.Timeouts: missing wait on '"+n.classOf(this)+"'");if(typeof i!="number"||i<0||Math.floor(i)!==i)throw new Error("Mixin.Timeouts: wait invalid on '"+n.classOf(this)+"'");o=e.instanceData(this,"Timeouts");if(this.hasTimeout(t))throw new Error("Mixin.Timeouts: timeout '"+t+"' already exists on '"+n.classOf(this)+"'");return s=Array.prototype.slice.call(arguments,3),u=setTimeout(function(){return a.killTimeout(t),r.apply(a,s)},i),o.timeouts[t]=u,this},hasTimeout:function(t){var n;return n=e.instanceData(this,"Timeouts"),t in n.timeouts},timeoutCount:function(){var t,n,r,i,s;n=e.instanceData(this,"Timeouts"),t=0,s=n.timeouts;for(r in s)i=s[r],t++;return t},timeouts:function(){var t,n,r,i,s;t=e.instanceData(this,"Timeouts"),r=[],s=t.timeouts;for(n in s)i=s[n],r.push(n);return r},killTimeout:function(t){var n;n=e.instanceData(this,"Timeouts");if(!this.hasTimeout(t))throw new Error("Mixin.Timeouts: timeout '"+t+"' does not exist. For a less-strict check, use killTimeoutIfExists");return this.killTimeoutIfExists(t),this},killTimeoutIfExists:function(t){var n,r;return n=e.instanceData(this,"Timeouts"),r=n.timeouts[t],r&&clearTimeout(r),delete n.timeouts[t],this},killAllTimeouts:function(){var t,n,r,i;n=e.instanceData(
this,"Timeouts"),i=n.timeouts;for(r in i)t=i[r],this.killTimeoutIfExists(r);return this}}},e.registerMixin(e.Timeouts._mixin_info),e})}).call(this);